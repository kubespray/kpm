local kpm = import "kpm.libjsonnet";

function(
 params={}
)

kpm.package({
  package:  {expander: 'jinja2'} + {{manifest.package}},

  variables: {{manifest.variables}},

{% if manifest.shards is defined and manifest.shards|length > 0 %}
 shards: {{manifest.shards}},
{% endif %}

{% if manifest.resources is defined and manifest.resources|length > 0 %}
 resources: [{% for item in manifest.resources %}
    {{item|json}} + {template: (importstr "templates/{{item.file}}")},
{%- endfor %}
],
{% endif %}
 deploy: {{manifest.deploy}}

}, params)
